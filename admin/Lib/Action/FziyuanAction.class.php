<?phpdefined ( 'IN_ADMIN' ) or die ( 'Access Denied' );class FziyuanAction extends FbaseAction {    /**     * @name初始化     */    protected function _initialize() {        parent::_initialize();        $in = &$this->in;        header("Content-type:text/html;charset=utf-8");    }    /**     * 属性管理     */    public function shuxing(){        //获取所有属性        $_s = M('shuxing');        $data = $_s->select();        $this->assign('data',$data);        $this->display();    }    /**     * 添加属性     */    public function add_shuxing(){        $in = &$this->in;        if ($this->ispost()) {            $in['info']['shuxing_name'] = trim($in['info']['shuxing_name']) ? trim($in['info']['shuxing_name']) : '';            $in['info']['sort'] = intval($in['info']['sort']) ? intval($in['info']['sort']) : 0;            if(!$in['info']['shuxing_name']){                $this->message ('属性名不能为空！' );exit;            }            $_s = M('shuxing');            if($_s->add($in['info'])){                $this->message('<font class="green">操作成功！</font>',U('fziyuan/shuxing'));exit;            }            $this->message ('操作失败！' );exit;        }        $this->display();    }    /**     * 编辑属性     */    public function edit_shuxing(){        $in = &$this->in;        $id = intval($in['id']);        $this->assign('shuxing_id',$id);        if(!$id){            $this->message ('参数错误！' );exit;        }        $_s = M('shuxing');        if ($this->ispost()) {            $in['info']['shuxing_name'] = trim($in['info']['shuxing_name']) ? trim($in['info']['shuxing_name']) : '';            $in['info']['sort'] = intval($in['info']['sort']) ? intval($in['info']['sort']) : 0;            if(!$in['info']['shuxing_name']){                $this->message ('属性名不能为空！' );exit;            }            if($_s->where(array('id'=>$id))->save($in['info'])){                $this->message('<font class="green">操作成功！</font>',U('fziyuan/shuxing'));exit;            }            $this->message ('操作失败！' );exit;        }        $shuxing_info = $_s->where(array('id'=>$id))->find();        $this->assign('shuxing_info',$shuxing_info);        $this->display();    }    /**     * 删除属性     */    public function delete_shuxing(){        $in = &$this->in;        $id = intval($in['id']);        if(!$id){            $this->message ('参数错误！' );exit;        }        $_s = M('shuxing');        if($_s->where(array('id'=>$id))->delete()){            $this->message('<font class="green">操作成功！</font>',U('fziyuan/shuxing'));exit;        }        $this->message ('操作失败！' );exit;    }    /**     * 添加资源属性     */    public function add_ziyuanshuxing(){        $in = &$this->in;        $_zs = M('shuxing');        $shuxing_list = $_zs->select();        $this->assign('shuxing_list',$shuxing_list);        if ($this->ispost()) {            $in['info']['sid'] = intval($in['info']['sid']) ? intval($in['info']['sid']) : 0;            $in['info']['sort'] = intval($in['info']['sort']) ? intval($in['info']['sort']) : 0;            $in['info']['zs_name'] = trim($in['info']['zs_name']) ? trim($in['info']['zs_name']) : '';            if(!$in['info']['sid']){                $this->message ('资源不能为空！' );exit;            }            if(!$in['info']['zs_name']){                $this->message ('资源属性名不能为空！' );exit;            }            $_s = M('shuxing_ziyuan');            if($_s->add($in['info'])){                $this->message('<font class="green">操作成功！</font>',U('fziyuan/ziyuanshuxing'));exit;            }            $this->message ('操作失败！' );exit;        }        $this->display();    }    public function ziyuanshuxing(){        //获取所有资源属性        $_sz = M();        $sql = "select a.id sz_id,a.sid,a.zs_name,a.sort,b.shuxing_name from fangfa_shuxing_ziyuan a        left join fangfa_shuxing b on a.sid=b.id order by a.sort asc";        $data = $_sz->query($sql);        $this->assign('data',$data);        $this->display();    }    public function edit_ziyuanshuxing(){        $in = &$this->in;        $id = intval($in['id']);        $this->assign('zs_id',$id);        if(!$id){            $this->message ('参数错误！' );exit;        }        $_zs = M('shuxing');        $shuxing_list = $_zs->select();        $this->assign('shuxing_list',$shuxing_list);        $_sz = M('shuxing_ziyuan');        $shuxingziyuan_info = $_sz->where(array('id'=>$id))->find();        $this->assign('shuxingziyuan_info',$shuxingziyuan_info);        if ($this->ispost()) {            $in['info']['sid'] = intval($in['info']['sid']) ? intval($in['info']['sid']) : 0;            $in['info']['zs_name'] = trim($in['info']['zs_name']) ? trim($in['info']['zs_name']) : '';            if(!$in['info']['sid']){                $this->message ('资源不能为空！' );exit;            }            if(!$in['info']['zs_name']){                $this->message ('资源属性名不能为空！' );exit;            }            $_s = M('shuxing_ziyuan');            if($_s->where(array('id'=>$id))->save($in['info'])){                $this->message('<font class="green">操作成功！</font>',U('fziyuan/ziyuanshuxing'));exit;            }            $this->message ('操作失败！' );exit;        }        $this->display();    }    public function delete_ziyuanshuxing(){        $in = &$this->in;        $id = intval($in['id']);        if(!$id){            $this->message ('参数错误！' );exit;        }        $_s = M('shuxing_ziyuan');        if($_s->where(array('id'=>$id))->delete()){            $this->message('<font class="green">操作成功！</font>',U('fziyuan/ziyuanshuxing'));exit;        }        $this->message ('操作失败！' );exit;    }}